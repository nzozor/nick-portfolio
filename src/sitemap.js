const convert = require('xml-js'),
  fs = require('fs'),
  options = {
    compact: true,
    ignoreComment: true,
    spaces: 4
  },
  moment = require('moment');
const url = 'https://www.nicolaszozor.com';

const projects = [
  {
    projectId: 'beauti',
    projectName: 'Beauti Skin Clinic London',
    projectDescription: `I developed from scratch a new website and online presence for a beauty and skin clinic in London.
      For this project I use a headless content management system and Angular front end Framework. This architecture provides maximum flexibility, scalibility and performance.`,
    clientName: 'Beauti Skin Clinic',
    clientUrl: 'http://www.beautiskinclinic.com',
    services: 'Full stack development, CMS implementation, SEO optimisation',
    country: 'UK',
    mainImgUrlSmall:
      '/assets/images/projects/beauti/Beauti-skin-clinic-london-website-design-mobile.jpg',
    mainImgUrlLarge:
      '/assets/images/projects/beauti/Beauti-skin-clinic-london-website-design-main.jpg',
    thumbnailUrlSmall:
      '/assets/images/projects/beauti/Beauti-skin-clinic-london-website-design-mobile.jpg',
    thumbnailUrlLarge:
      '/assets/images/projects/beauti/Beauti-skin-clinic-london-website-design-thumb.jpg',
    galleryImgs: [
      {
        smallImgUrl:
          '/assets/images/projects/beauti/Tracks_Beauti-dashboard.jpg',
        largeImgUrl:
          '/assets/images/projects/beauti/Tracks_Beauti-dashboard.jpg',
        type: 'full',
      },
      {
        smallImgUrl:
          '/assets/images/projects/beauti/Beauti-skin-clinic-london-website-mobileapp-mobile.jpg',
        largeImgUrl:
          '/assets/images/projects/beauti/Beauti-skin-clinic-london-website-mobileapp-big.jpg',
        type: 'full',
      },
    ],
    imgAlt: 'Beauti Skin Clinic London | Elsa Benoldi Graphic Design',
  },
  {
    projectId: 'Sohohouse',
    projectName: 'Soho House',
    projectDescription:
      "I'm actually working as a contractor for this hospitality company. The Soho House is  a member's club founded in 1995, a home for creative people to come together. I'm helping to develop the bedroom booking section.",
    clientName: 'Sohohouse',
    clientUrl: 'https://www.sohohouse.com/',
    services: 'Front-end development',
    country: 'UK',
    mainImgUrlSmall: '/assets/images/projects/sohohouse/SohoHouse_Desktop.jpg',
    mainImgUrlLarge: '/assets/images/projects/sohohouse/SohoHouse_Desktop.jpg',
    thumbnailUrlSmall:
      '/assets/images/projects/sohohouse/SohoHouse_Desktop.jpg',
    thumbnailUrlLarge:
      '/assets/images/projects/sohohouse/SohoHouse_Desktop.jpg',
    galleryImgs: [
      {
        smallImgUrl:
          '/assets/images/projects/sohohouse/SohoHouse_Desktop-Mobile.jpg',
        largeImgUrl:
          '/assets/images/projects/sohohouse/SohoHouse_Desktop-Mobile.jpg',
        type: 'full',
      },
    ],
    imgAlt: 'Flavia Frigeri | Elsa Benoldi Graphic Design',
  },
  {
    projectId: 'pic',
    projectName: 'Pension insurrance corporation',
    projectDescription:
      'As a contractor I helped the development team of this multi billions pounds pension investment company to build financial web applications. We created tools and dashboards to help the financial team to make better decisions for their investment portfolios.',
    clientName: 'Pension inssurance corporation',
    clientUrl: '',
    services: 'Financial App development',
    country: 'UK',
    mainImgUrlSmall: '/assets/images/projects/pic/pic-main.jpg',
    mainImgUrlLarge: '/assets/images/projects/pic/pic-main.jpg',
    thumbnailUrlSmall: '/assets/images/projects/pic/pic-main.jpg',
    thumbnailUrlLarge: '/assets/images/projects/pic/pic-main.jpg',
    galleryImgs: [
      {
        smallImgUrl: '/assets/images/projects/pic/Tracks_Dashboard.jpg',
        largeImgUrl: '/assets/images/projects/pic/Tracks_Dashboard.jpg',
        type: 'full',
      },
    ],
    imgAlt: 'Pension inssurance corporation',
  },
  {
    projectId: 'flavia-frigeri',
    projectName: 'Flavia Frigeri',
    projectDescription:
      'Brand identity and responsive website design for Flavia Frigeri an art historian, curator and lecturer who focuses on modern and contemporary art. A clear, modular, and fundamentally minimal grid provides a ‘simple’ canvas to highlight the relevance of Flavia’s commissions.',
    clientName: 'Flavia Frigeri',
    clientUrl: 'https://www.flaviafrigeri.com/',
    services: 'Logo, Website Design',
    country: 'UK',
    mainImgUrlSmall:
      '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-homepage-mobile.jpg',
    mainImgUrlLarge:
      '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-homepage-main.jpg',
    thumbnailUrlSmall:
      '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-homepage-mobile.jpg',
    thumbnailUrlLarge:
      '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-homepage-thumb.jpg',
    galleryImgs: [
      {
        smallImgUrl:
          '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-exhibitions-mobile.jpg',
        largeImgUrl:
          '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-exhibitions-big.jpg',
        type: 'full',
      },
      {
        smallImgUrl:
          '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-books-mobile.jpg',
        largeImgUrl:
          '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-books-big.jpg',
        type: 'full',
      },
      {
        smallImgUrl:
          '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-essays-mobile.jpg',
        largeImgUrl:
          '/assets/images/projects/flaviafrigeri/flavia-frigeri-website-ui-branding-essays-big.jpg',
        type: 'full',
      },
    ],
    imgAlt: 'Flavia Frigeri | Elsa Benoldi Graphic Design',
  },
  {
    projectId: 'elsa-benoldi',
    projectName: 'Elsa Benoldi portfolio',
    projectDescription:
      'Portfolio website developed for a creative director based in London. An elegant website to get to know this successful creative director based in London.',
    clientName: 'Elsa Benoldi',
    clientUrl: 'https://www.elsabenoldi.com',
    services: 'Full stack web development',
    country: 'UK',
    mainImgUrlSmall: '/assets/images/projects/elsa-benoldi/Elsa-ipad_Main.jpg',
    mainImgUrlLarge: '/assets/images/projects/elsa-benoldi/Elsa-ipad_Main.jpg',
    thumbnailUrlSmall:
      '/assets/images/projects/elsa-benoldi/Elsa-ipad_Main.jpg',
    thumbnailUrlLarge:
      '/assets/images/projects/elsa-benoldi/Elsa-ipad_Main.jpg',
    galleryImgs: [
      {
        smallImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_4.jpg',
        largeImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_4.jpg',
        type: 'full',
      },
      {
        smallImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_2.jpg',
        largeImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_2.jpg',
        type: 'full',
      },
      {
        smallImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_2.jpg',
        largeImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_2.jpg',
        type: 'full',
      },
      {
        smallImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_3.jpg',
        largeImgUrl: '/assets/images/projects/elsa-benoldi/Elsa-ipad_3.jpg',
        type: 'full',
      },
    ],
    imgAlt: 'Elsa Benoldi | Creative Director Graphic Design',
  },
  {
    projectId: 'global',
    projectName: 'Global media',
    projectDescription: `As a contractor I helped Global media to deliver on time a complex internal media web solution fo their business.
    It involved audio and live stream. Using the power of Angular front end framework coupled with Rxjs technology we managed to easily handled multiple and asynchronous stream of data.`,
    clientName: 'Global media',
    clientUrl: '',
    services: 'Web media app development',
    country: 'Uk',
    mainImgUrlSmall: '/assets/images/projects/global/Tracks_Global-2.jpg',
    mainImgUrlLarge: '/assets/images/projects/global/Tracks_Global-2.jpg',
    thumbnailUrlSmall: '/assets/images/projects/global/Tracks_Global-2.jpg',
    thumbnailUrlLarge: '/assets/images/projects/global/Tracks_Global-2.jpg',
    galleryImgs: [
      {
        smallImgUrl: '/assets/images/projects/global/Tracks_Global.jpg',
        largeImgUrl: '/assets/images/projects/global/Tracks_Global.jpg',
        type: 'full',
      },
    ],
    imgAlt: 'Global Media',
  },
];

function readXml() {
  fs.readFile('./sitemap.xml', (err, data) => {
    if (data) {
      const existingSitemapList = JSON.parse(convert.xml2json(data, options));
      let existingSitemapURLStringList = [];
      if (existingSitemapList.urlset && existingSitemapList.urlset.url && existingSitemapList.urlset.url.length) {
          existingSitemapURLStringList = existingSitemapList.urlset.url.map(ele => ele.loc._text);
      }
      for (const project of projects) {

        if (existingSitemapURLStringList.indexOf(`${url}/${project.projectId}`) == -1) {
          existingSitemapList.urlset.url.push({
            loc: {
              _text: `${url}/${project.projectId}`,
            },
            changefreq: {
              _text: 'monthly'
            },
            priority: {
              _text: 0.8
            },
            lastmod: {
              _text: moment(new Date()).format('YYYY-MM-DD')
            }
          });
        }
      }
      createSitemapFile(existingSitemapList);
    }
  });
}

/*
    Method to convert JSON format data into XML format
*/
const createSitemapFile = (list) => {
  const finalXML = convert.json2xml(list, options); // to convert json text to xml text
  saveNewSitemap(finalXML);
}

/*
  Method to Update sitemap.xml file content
*/
const saveNewSitemap = (xmltext) => {
  fs.writeFile('sitemap.xml', xmltext, (err) => {
      if (err) {
          return console.log(err);
      }

      console.log("The file was saved!");
  });
}

readXml();
